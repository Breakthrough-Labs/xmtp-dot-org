---
sidebar_label: Remote Attachment
sidebar_position: 6
---

import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";

# Remote Attachment Content Type

![Status](https://img.shields.io/badge/Content_type_status-Standards--track-yellow) ![Status](https://img.shields.io/badge/Reference_implementation_status-Stable-31CA54)

Remote attachments of any size can be sent using the `RemoteAttachmentCodec` and a storage provider.

:::tip Open for feedback

You are welcome to provide feedback by commenting on the [XIP Remote Attachment Content Type](https://github.com/xmtp/XIPs/blob/main/XIPs/xip-17-remote-attachment-content-type-proposal.md) Proposal.

:::

### Configure content type

In some SDK's the `AttachmentCodec` is already included in the SDK. If not, you can install the package using the following command:

<Tabs groupId="sdk-langs">
<TabItem value="js" label="JavaScript"  attributes={{className: "js_tab"}}>

In the javascript SDK you need to import this package first.

```bash
npm i @xmtp/content-type-remote-attachment
```

After importing the package you can register the codec.

```jsx
import {
  ContentTypeAttachment,
  AttachmentCodec,
  RemoteAttachmentCodec,
  ContentTypeRemoteAttachment,
} from "@xmtp/content-type-remote-attachment";
// Create the XMTP client
const xmtp = await Client.create(signer, { env: "dev" });
// Register the codecs, AttachmentCodec is for handling local attachments under 1MB
xmtp.registerCodec(new AttachmentCodec());
xmtp.registerCodec(new ContentTypeRemoteAttachment());
```

</TabItem>
<TabItem value="react" label="React"  attributes={{className: "react_tab"}}>

The React SDK supports all current standards-track content types, but only text messages are enabled out of the box. Adding support for other standards-track content types requires a bit of configuration.

```jsx
import {
  XMTPProvider,
  attachmentContentTypeConfig,
} from "@xmtp/react-sdk";

const contentTypeConfigs = [
  attachmentContentTypeConfig,
];

createRoot(document.getElementById("root") as HTMLElement).render(
  <StrictMode>
    <XMTPProvider contentTypeConfigs={contentTypeConfigs}>
      <App />
    </XMTPProvider>
  </StrictMode>,
);
```

</TabItem>
<TabItem value="swift" label="Swift"  attributes={{className: "swift_tab"}}>

```swift
Client.register(AttachmentCodec());
Client.register(RemoteAttachmentCodec());
```

</TabItem>
<TabItem value="kotlin" label="Kotlin"  attributes={{className: "kotlin_tab"}}>

```kotlin
import org.xmtp.android.library.codecs.Attachment
import org.xmtp.android.library.codecs.AttachmentCodeca
import org.xmtp.android.library.codecs.ContentTypeAttachment

Client.register(codec = AttachmentCodec())
Client.register(codec = RemoteAttachmentCodec())
```

</TabItem>
</Tabs>

### Send encrypted file

<Tabs groupId="sdk-langs">
<TabItem value="js" label="JavaScript"  attributes={{className: "js_tab"}}>

Read local file and extract its details

```tsx
const file = fs.readFileSync("xmtp.png");
const filename = path.basename("xmtp.png");
const extname = path.extname("xmtp.png");
console.log(`Filename: ${filename}`);
console.log(`File Type: ${extname}`);
```

Sending the file

```tsx
//Import it in case you didnt' before
import { ContentTypeAttachment } from "@xmtp/content-type-remote-attachment";

// Convert the file to a Uint8Array
const blob = new Blob([file], { type: extname });
let imgArray = new Uint8Array(await blob.arrayBuffer());

//Create an attachment object
const attachment = {
  filename: filename,
  mimeType: extname, //image, video or audio
  data: imgArray,
};

console.log("Attachment created", attachment);
await conversation.send(attachment, { contentType: ContentTypeAttachment });
```

</TabItem>
<TabItem value="react" label="React"  attributes={{className: "react_tab"}}>

```jsx
//Create an attachment object
const attachment: Attachment = {
  filename: "screenshot.png",
  mimeType: "image/png",
  data: [the PNG data]
}
//Create a preview attachment object
URL.createObjectURL(
  new Blob([Buffer.from(somePNGData)], {
    type: attachment.mimeType,
  }),
)
//Send the attachment
await conversation.send(
  attachment,
  { contentType: ContentTypeAttachment },
)
```

</TabItem>
<TabItem value="swift" label="Swift"  attributes={{className: "swift_tab"}}>

```swift
//Load file
let fileData = Data(contentsOf: URL(fileURLWithPath: "path_to_file"))
//Create an Attachment Object:
let attachment = Attachment(
  filename: "screenshot.png",
  mimeType: "image/png",
  data: fileData
)
//Send the attachment
try await conversation.send(
	content: attachment,
	options: .init(
		contentType: ContentTypeAttachment
	)
)
```

</TabItem>
<TabItem value="kotlin" label="Kotlin"  attributes={{className: "kotlin_tab"}}>

```kotlin
//Create an attachment
val attachment = Attachment(
  filename = "test.txt",
  mimeType = "text/plain",
  data = "hello world".toByteStringUtf8(),
)

//Send the attachment
newConversation.send(
    content = attachment,
    options = SendOptions(contentType = ContentTypeAttachment),
)
```

</TabItem></Tabs>

### Create an attachment object

<Tabs>
<TabItem value="javascript" label="JavaScript" attributes={{className: "js_tab"}}>

```tsx
// Local file details
const attachment = {
  filename: filename,
  mimeType: extname,
  data: new Uint8Array(data),
};
```

</TabItem>
</Tabs>

### Encrypt the attachment

Use the `RemoteAttachmentCodec.encodeEncrypted` to encrypt the attachment:

<Tabs groupId="sdk-langs">
<TabItem value="js" label="JavaScript"  attributes={{className: "js_tab"}}>

```tsx
const encryptedEncoded = await RemoteAttachmentCodec.encodeEncrypted(
  attachment,
  new AttachmentCodec(),
);
```

</TabItem></Tabs>

### Upload the encrypted attachment

Upload the encrypted attachment anywhere where it will be accessible via an HTTPS GET request. For example, you can use web3.storage:

<Tabs>
<TabItem value="web3storage" label="Web3 Storage" attributes={{className: "web3storage_tab"}} >

```tsx
const { Web3Storage } = require("web3.storage");

class Upload {
  constructor(name, data) {
    this.name = name;
    this.data = data;
  }

  stream() {
    const self = this;
    return new ReadableStream({
      start(controller) {
        controller.enqueue(Buffer.from(self.data));
        controller.close();
      },
    });
  }
}

const upload = new Upload("uploadIdOfYourChoice", encryptedEncoded.payload);

const web3Storage = new Web3Storage({
  token: "YOURTOKENHERE",
});

const cid = await web3Storage.put([upload]);
const url = `https://${cid}.ipfs.w3s.link/uploadIdOfYourChoice`;
```

</TabItem>
<TabItem value="thirdweb" label="Thirdweb" attributes={{className: "thirdweb_tab"}}>

```tsx
import { useStorageUpload } from "@thirdweb-dev/react";
const { mutateAsync: upload } = useStorageUpload();
const uploadUrl = await upload({
  //encryptedEncoded.payload.buffer is a Uint8Array
  //We need to convert it to a File to upload it to the IPFS network
  data: [new File([encryptedEncoded.payload.buffer], file.name)], // Convert Uint8Array back to File
  options: { uploadWithGatewayUrl: true, uploadWithoutDirectory: true },
});
const url = uploadUrl[0];
```

</TabItem>
</Tabs>

### Create a remote attachment

Now that you have a `url`, you can create a `RemoteAttachment`.

<Tabs groupId="sdk-langs">
<TabItem value="js" label="JavaScript"  attributes={{className: "js_tab"}}>

```jsx
const remoteAttachment = {
  url: url,
  contentDigest: encryptedEncoded.digest,
  salt: encryptedEncoded.salt,
  nonce: encryptedEncoded.nonce,
  secret: encryptedEncoded.secret,
  scheme: "https://",
  filename: attachment.filename,
  contentLength: attachment.data.byteLength,
};
```

</TabItem></Tabs>

### Send a remote attachment

Now that you have a remote attachment, you can send it:

<Tabs groupId="sdk-langs">
<TabItem value="js" label="JavaScript"  attributes={{className: "js_tab"}}>

```tsx
await conversation.send(remoteAttachment, {
  contentType: ContentTypeRemoteAttachment,
});
```

</TabItem></Tabs>

## Download, decrypt, and decode the attachment

Now that you can receive a remote attachment, you need a way to receive a remote attachment. For example:

<Tabs groupId="sdk-langs">
<TabItem value="js" label="JavaScript"  attributes={{className: "js_tab"}}>

```tsx
if (message.contentType.sameAs(RemoteAttachmentContentType)) {
  const attachment = await RemoteAttachmentCodec.load(message.content, client);
}
```

</TabItem></Tabs>

- You now have the original attachment:

```bash
attachment.filename // => "screenshot.png"
attachment.mimeType // => "image/png",
attachment.data // => [the PNG data]
```

## Create a preview attachment object

Once you have the attachment object created, you can also create a preview for what to show in a message input before sending:

<Tabs groupId="sdk-langs">
<TabItem value="js" label="JavaScript"  attributes={{className: "js_tab"}}>

```tsx
URL.createObjectURL(
    new Blob([Buffer.from(attachment.data)], {
    type: attachment.mimeType,
  }),
),
```

</TabItem></Tabs>
