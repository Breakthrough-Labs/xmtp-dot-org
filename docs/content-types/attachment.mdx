---
sidebar_label: Attachment
sidebar_position: 5
---

import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";

# Attachment Content Type

![Status](https://img.shields.io/badge/Content_type_status-Standards--track-yellow) ![Status](https://img.shields.io/badge/Reference_implementation_status-Stable-31CA54)

Attachments smaller than 1MB can be sent using the `AttachmentCodec`. The codec will automatically encrypt the attachment and upload it to the XMTP network.

:::tip Open for feedback

You are welcome to provide feedback by commenting on the [Attachment Content Type XIP](https://github.com/xmtp/XIPs/blob/main/XIPs/xip-15-attachment-content-type.md) Proposal.

:::

### Configure content type

In some SDK's the `AttachmentCodec` is already included in the SDK. If not, you can install the package using the following command:

<Tabs groupId="sdk-langs">
<TabItem value="js" label="JavaScript"  attributes={{className: "js_tab"}}>

In the javascript SDK you need to import this package first.

```bash
npm i @xmtp/content-type-remote-attachment
```

After importing the package you can register the codec.

```jsx
import {
  ContentTypeAttachment,
  AttachmentCodec,
} from "@xmtp/content-type-remote-attachment";
// Create the XMTP client
const xmtp = await Client.create(signer, { env: "dev" });
// Register the codecs, AttachmentCodec is for handling local attachments under 1MB
xmtp.registerCodec(new AttachmentCodec());
```

</TabItem>
<TabItem value="react" label="React"  attributes={{className: "react_tab"}}>

The React SDK supports all current standards-track content types, but only text messages are enabled out of the box. Adding support for other standards-track content types requires a bit of configuration.

```jsx
import {
  XMTPProvider,
  attachmentContentTypeConfig,
} from "@xmtp/react-sdk";

const contentTypeConfigs = [
  attachmentContentTypeConfig,
];

createRoot(document.getElementById("root") as HTMLElement).render(
  <StrictMode>
    <XMTPProvider contentTypeConfigs={contentTypeConfigs}>
      <App />
    </XMTPProvider>
  </StrictMode>,
);
```

</TabItem>
<TabItem value="swift" label="Swift"  attributes={{className: "swift_tab"}}>

```swift
Client.register(AttachmentCodec());
```

</TabItem>
<TabItem value="kotlin" label="Kotlin"  attributes={{className: "kotlin_tab"}}>

```kotlin
import org.xmtp.android.library.codecs.Attachment
import org.xmtp.android.library.codecs.AttachmentCodec
import org.xmtp.android.library.codecs.ContentTypeAttachment

Client.register(codec = AttachmentCodec())
```

</TabItem>
</Tabs>

### Send encrypted file

<Tabs groupId="sdk-langs">
<TabItem value="js" label="JavaScript"  attributes={{className: "js_tab"}}>

Read local file and extract its details

```tsx
const file = fs.readFileSync("xmtp.png");
const filename = path.basename("xmtp.png");
const extname = path.extname("xmtp.png");
console.log(`Filename: ${filename}`);
console.log(`File Type: ${extname}`);
```

Sending the file

```tsx
//Import it in case you didnt' before
import { ContentTypeAttachment } from "@xmtp/content-type-remote-attachment";

// Convert the file to a Uint8Array
const blob = new Blob([file], { type: extname });
let imgArray = new Uint8Array(await blob.arrayBuffer());

//Create an attachment object
const attachment = {
  filename: filename,
  mimeType: extname, //image, video or audio
  data: imgArray,
};

console.log("Attachment created", attachment);
await conversation.send(attachment, { contentType: ContentTypeAttachment });
```

</TabItem>
<TabItem value="react" label="React"  attributes={{className: "react_tab"}}>

```jsx
//Create an attachment object
const attachment: Attachment = {
  filename: "screenshot.png",
  mimeType: "image/png",
  data: [the PNG data]
}
//Create a preview attachment object
URL.createObjectURL(
  new Blob([Buffer.from(somePNGData)], {
    type: attachment.mimeType,
  }),
)
//Send the attachment
await conversation.send(
  attachment,
  { contentType: ContentTypeAttachment },
)
```

</TabItem>
<TabItem value="swift" label="Swift"  attributes={{className: "swift_tab"}}>

```swift
//Load file
let fileData = Data(contentsOf: URL(fileURLWithPath: "path_to_file"))
//Create an Attachment Object:
let attachment = Attachment(
  filename: "screenshot.png",
  mimeType: "image/png",
  data: fileData
)
//Send the attachment
try await conversation.send(
	content: attachment,
	options: .init(
		contentType: ContentTypeAttachment
	)
)
```

</TabItem>
<TabItem value="kotlin" label="Kotlin"  attributes={{className: "kotlin_tab"}}>

```kotlin
//Create an attachment
val attachment = Attachment(
  filename = "test.txt",
  mimeType = "text/plain",
  data = "hello world".toByteStringUtf8(),
)

//Send the attachment
newConversation.send(
    content = attachment,
    options = SendOptions(contentType = ContentTypeAttachment),
)
```

</TabItem></Tabs>

### Receive encrypted file

Receive the attachment

<Tabs groupId="sdk-langs">
<TabItem value="js" label="JavaScript"  attributes={{className: "js_tab"}}>

```jsx
if (message.contentType.sameAs(ContentTypeAttachment)) {
  const blobdecoded = new Blob([message.content.data], {
    type: message.content.mimeType,
  });
  const url = URL.createObjectURL(blobdecoded);
}
```

</TabItem>
<TabItem value="react" label="React"  attributes={{className: "react_tab"}}>

```tsx
// Assume `loadLastMessage` is a thing you have
const message: DecodedMessage = await loadLastMessage();
const attachment = message.content as Attachment;

if (!message.contentType.sameAs(ContentTypeAttachment)) {
  //Render it as an image
  const objectURL = URL.createObjectURL(
    new Blob([Buffer.from(attachment.data)], {
      type: attachment.mimeType,
    }),
  );

  const img = document.createElement("img");
  img.src = objectURL;
  img.title = attachment.filename;

  return;
}

// We've got an attachment.
const attachment: Attachment = message.content;
```

</TabItem>
<TabItem value="swift" label="Swift"  attributes={{className: "swift_tab"}}>

```swift
//Get the latest message
let attachment: Attachment = try message.content()
// "icon.png", attachment.filename
// "image/png", attachment.mimeType
```

</TabItem>
<TabItem value="kotlin" label="Kotlin"  attributes={{className: "kotlin_tab"}}>

```kotlin
//Get the latest message
val loadedAttachment: Attachment = message.content()

loadedAttachment.fetcher = Fetcher()
runBlocking {
    val attachment: Attachment = loadedAttachment.load()
}
```

</TabItem>
</Tabs>
